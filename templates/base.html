<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!--bootstrap-->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css')}}"  type="text/css" />
    <link rel="stylesheet" href="{{url_for('static', filename='css/clean-blog.min.css')}}"  type="text/css" />
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}" type="text/css" />
    <link rel="stylesheet" href="{{url_for('static', filename='css/land_positions.css')}}" type="text/css"/>
    <link rel="stylesheet" href="{{url_for('static', filename='css/sea_positions.css')}}" type="text/css"/>


    <title>Diplomacy</title>
</head>

<body>
  <main role="main" class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="container board-image">
          
          <!-- Board -->
          {% block board %}
          {% endblock %}
        
          <!-- Flash Messages -->
          {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
          {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            {{ message }}
          </div>
          {% endfor %}
          {% endif %}
          {% endwith %}
          
        </div>
        
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#intefaceModal">
          Menu
        </button>

        <!-- Modal -->
        <div class="modal fade" id="intefaceModal" tabindex="-1" role="dialog" aria-labelledby="intefaceModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div id="draggable" class="modal-content">
              
              <!-- Modal Header -->
              <div class="modal-header">
                <div role="tabpanel">
                  
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                    <div class="row">
                      <!-- Tab Buttons -->
                    
                    
                    
                    <!-- if logged in -->
                    {% if not user %}
                    <!--registration tab -->
            
                    
                    <li role="presentation" class="{% if not session['username'] %} active {% endif %} nav-tab-button-style">
                      <a href="#registrationTab" aria-controls="registrationTab" role="tab" data-toggle="tab">
                        <h5 class="modal-title" id="intefaceModalLabel">Register</h5>
                      </a>
                    </li>
                    <span> | </span>
                    
                    <!--log in tab -->
                    <li role="presentation" class ="nav-tab-button-style">
                      <a href="#loginTab" aria-controls="loginTab" role="tab" data-toggle="tab">
                        <h5 class="modal-title" id="intefaceModalLabel">Login</h5>
                      </a>
                    </li>
                    
                    {% else %}
                    
                    {% if not user['orders_finalised'] %}
                    <!-- orders tab -->
                    <li role="presentation" class="{% if session['username'] %} active {% endif %} nav-tab-button-style">
                      <a href="#ordersTab" aria-controls="ordersTab" role="tab" data-toggle="tab">
                        <h5 class="modal-title" id="intefaceModalLabel">Orders</h5>
                      </a>
                    </li>
                    <span> | </span>
                    
                    {% else %}
                    <!-- edit orders tab -->
                    <li role="presentation" class="{% if session['username'] %} active {% endif %} nav-tab-button-style">
                      <a href="#editOrdersTab" aria-controls="editOrdersTab" role="tab" data-toggle="tab">
                        <h5 class="modal-title" id="intefaceModalLabel">Edit Orders</h5>
                      </a>
                    </li>
                    <span> | </span>
                    {% endif %}
                    
                    <!-- messages tab -->
                    <li role="presentation" class ="nav-tab-button-style">
                      <a href="#messagesTab" aria-controls="messagesTab" role="tab" data-toggle="tab">
                        <h5 class="modal-title" id="intefaceModalLabel">Messages</h5>
                      </a>
                    </li>
                    <span> | </span>
                    
                    <!-- log out tab -->
                    <li role="presentation" class="active nav-tab-button-style">
                      <a href="{{ url_for('logout') }}">
                        <h5 class="modal-title" id="intefaceModalLabel">Log Out</h5>
                      </a>
                    </li>
                    
                    {% endif %}
                    </div>
                  </ul>
                <!-- close modal button -->
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
                
              <!-- Modal Body -->
              <div class="modal-body">
                
                <!-- Tab panes -->
                <div class="tab-content">
                  
                  {% if not user %}
                  
                  <!--Registration Form-->
                  <div role="tabpanel" class="tab-pane active" id="registrationTab">
                    <form method="POST" action="/register">
                      {{ registration_form.hidden_tag() }}
                      <fieldset class="form-group">
                        
                        <!-- username -->
                        <div class="form-group">
                          <i class="fa fa-user"></i> {{ registration_form.username.label(class="form-control-label") }}
                          {% if registration_form.username.errors %}
                          {{ registration_form.username(class="form-control form-control-lg is-invalid") }}
                          <div class="invalid-feedback">
                            {% for error in registration_form.username.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                          </div>
                          {% else %}
                              {{ registration_form.username(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                        
                        <!-- email -->
                        <div class="form-group">
                          <i class="fa fa-envelope prefix grey-text"></i> {{ registration_form.email.label(class="form-control-label") }}
                          {% if registration_form.email.errors %}
                            {{ registration_form.email(class="form-control form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                              {% for error in registration_form.email.errors %}
                              <span>{{ error }}</span>
                              {% endfor %}
                            </div>
                          {% else %}
                            {{ registration_form.email(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                        
                        <!-- password -->
                        <div class="form-group">
                          <i class="fa fa-lock prefix grey-text"></i> {{ registration_form.password.label(class="form-control-label") }}
                          {% if registration_form.password.errors %}
                            {{ registration_form.password(class="form-control form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                              {% for error in registration_form.password.errors %}
                                <span>{{ error }}</span>
                              {% endfor %}
                            </div>
                          {% else %}
                            {{ registration_form.password(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                        
                        <!-- password confirm -->
                        <div class="form-group">
                          {{ registration_form.confirm_password.label(class="form-control-label") }}
                          {% if registration_form.confirm_password.errors %}
                            {{ registration_form.confirm_password(class="form-control form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                              {% for error in registration_form.username.errors %}
                              <span>{{ error }}</span>
                              {% endfor %}
                            </div>
                          {% else %}
                            {{ registration_form.confirm_password(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                      </fieldset>
                      
                      <!-- submit -->
                      <div class="form-group">
                      {{ registration_form.submit(class="btn btn-outline-info") }}
                      </div>
                    </form>
                    
                    <!-- other options -->
                    <div class="border-top pt-3"></div>
                    <small class="text-muted">
                      Already Have An Account? <a href="#registrationTab" aria-controls="registrationTab" role="tab" data-toggle="tab">Log In</a>
                    </small>
                  </div>
                  
                  
                  <!-- Login Form -->
                  <div role="tabpanel" class="tab-pane" id="loginTab">
                    <form method="POST" action="/login">
                      {{ login_form.hidden_tag() }}
                      <fieldset class="form-group">
                          
                        <!-- email -->
                        <div class="form-group">
                          <i class="fa fa-envelope prefix grey-text"></i> {{ login_form.email.label(class="form-control-label") }}
                          {% if login_form.email.errors %}
                          {{ login_form.email(class="form-control form-control-lg is-invalid") }}
                          <div class="invalid-feedback">
                            {% for error in login_form.email.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                          </div>
                          {% else %}
                            {{ login_form.email(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                        
                        <!-- password -->
                        <div class="form-group">
                          <i class="fa fa-lock prefix grey-text"></i> {{ login_form.password.label(class="form-control-label") }}
                          {% if login_form.password.errors %}
                          {{ login_form.password(class="form-control form-control-lg is-invalid") }}
                          <div class="invalid-feedback">
                            {% for error in login_form.password.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                          </div>
                          {% else %}
                          {{ login_form.password(class="form-control form-control-lg") }}
                          {% endif %}
                        </div>
                        
                        <!-- remember -->
                        <div class="form-check">
                        {{ login_form.remember(class="form-check-input") }}
                        {{ login_form.remember.label(class="form-check-label") }}
                        </div>
                      </fieldset>
                      
                      <!-- submit -->
                      <div class="form-group">
                      {{ login_form.submit(class="btn btn-outline-info") }}
                      </div>
                    </form>
                    <small class="text-muted">
                      <a class="ml-2" href="#">Forgot Password?</a>
                    </small>
                    <div class="border-top pt-3"></div>
                    <small class="text-muted">
                      Need An Account? <a href="#registrationTab" aria-controls="registrationTab" role="tab" data-toggle="tab">Sign Up</a>
                    </small>
                  </div>
                  
                  
                  {% else %}
                  
                  {% if not user['orders_finalised'] %}
                  <!-- Orders -->
                  <div role="tabpanel" class="tab-pane" id="ordersTab">
                    <form method="POST" action="/orders">
                      {% for piece in user_pieces %}
                      <span>{{ piece.piece_type|capitalize }} {{ piece.territory.name }}</span>
                      <input class="order-input" type="text" name="{{user['nation']}} {{piece.territory.name}}"/>
                      <br>
                      
                      {% endfor %}
                      <div id="success"></div>
                      <br>
                      <div class="form-group">
                          <button type="submit" class="btn btn-primary" id="sendMessageButton">Finalise orders</button>
                      </div>
                    </form>
                  </div>
                  
                  {% else %}
                  <div role="tabpanel" class="tab-pane" id="editOrdersTab">
                    <form method="POST" action="/edit_orders">
                      {% for order in user['orders'] %}
                      <input class="order-input" type="text" name="{{user['nation']}} {{order["territory"]}}" value = "{{order['territory']}} {{order['command']}} {% if order['command'] in ['support', 'convoy'] %}{{order['object']}}{% endif %} {{order['target']}}"/>
                      <br>
                      
                      {% endfor %}
                      <div id="success"></div>
                      <br>
                      <div class="form-group">
                          <button type="submit" class="btn btn-primary" id="sendMessageButton">Edit orders</button>
                      </div>
                    </form>
                  </div>
                  {% endif %}
                  
                  <!-- messages -->
                  <div role="tabpanel" class="tab-pane active" id="messagesTab">
                    
                    <h5>Public Announcements</h5>
                    {% for announncement in announcements %}
                    <div>{{ announncement }} <br></div>
                    {% endfor %}
                    
                    <h5>Private Messages</h5>
                    {% for message in messsages %}
                    <div>{{ message }} <br></div>
                    {% endfor %}
                  </div>
                  
                  <!-- Add Announcements -->
                  <div role="tabpanel" class="tab-pane" id="addAnnouncementTab">
                    <form method="POST" action="/add_announcement">
                      <input type="text" name="announcement" />
                      <br>
                      <div class="form-group">
                          <button type="submit" class="btn btn-primary" id="sendMessageButton">Add Announcement</button>
                      </div>
                    </form>
                  </div>
                  
                  
                  {% endif %}
                </div>
              </div>
            <div class="modal-footer">
              {% for player in players %}
                <span class="player-flag"><img class="flag" src="{{url_for('static', filename='images/')}}{{player['nation']}}.png"></img>  {{player['username']}}</span>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
    
    <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

    <!-- Custom scripts for this template -->
    <script src="{{ url_for('static', filename='vendor/js/clean-blog.min.js') }}"></script>
    
    <!-- Order Form JavaScript -->
    <script src="{{ url_for('static', filename='js/jqBootstrapValidation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/contact_me.js') }}"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
    $( function() {
      $( "#draggable" ).draggable();
    } );
    </script>
    
    <script>
    $('#myModal').on('shown.bs.modal', function () {
      $('#myInput').trigger('focus')
    })
    
    
    </script>
    
</body>

</html>